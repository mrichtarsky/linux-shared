#!/usr/bin/env bash
set -euo pipefail

if tmux list-sessions 2>/dev/null | grep window &>/dev/null
then
    export "`tmux showenv PATH`"
    if [[ ! "$OSTYPE" =~ ^darwin ]];
    then
        export "`tmux showenv VSCODE_IPC_HOOK_CLI`"
    fi
fi

mcedit_remove_w()
{
    MCEDIT_ARGS="" # Remove -w if present
    for arg do
        shift
        [ "$arg" = "-w" ] && continue
        MCEDIT_ARGS="$MCEDIT_ARGS $arg"
    done
    MCEDIT_ARGS="${MCEDIT_ARGS## }"

    mcedit "$MCEDIT_ARGS"
}

code "$@" &>/dev/null || mcedit_remove_w "$@"
